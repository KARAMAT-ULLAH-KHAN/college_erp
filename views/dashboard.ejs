<!DOCTYPE html>
<!-- <?php
include 'connection.php';
include 'address.php';
SESSION_START();


if(isset($_SESSION['usersession'])&&$_SESSION['acclvl']==0){

}
else{
session_destroy();
mysqli_close($conn);
header("Location:./index.php");
}
if(isset($_POST['logout'])){
session_destroy();
mysqli_close($conn);
header("Location:./index.php");
}
{
	$check = mysqli_query($conn,"select * from roles");
								while($display= mysqli_fetch_array($check))
								{
									if($display['role_name']=='current attendance'){
										$current_attendance=$display['status'];
									}
									if($display['role_name']=='previous attendance'){
										$previous_attendance=$display['status'];
									}
									if($display['role_name']=='mark leaves'){
										$mark_leaves=$display['status'];
									}
									if($display['role_name']=='pre board marking'){
										$pre_board_marking=$display['status'];
									}
									if($display['role_name']=='pre board result'){
										$pre_board_result=$display['status'];
									}
									if($display['role_name']=='mid term marking'){
										$mid_term_marking=$display['status'];
									}
									if($display['role_name']=='mid term result'){
										$mid_term_result=$display['status'];
									}
									if($display['role_name']=='pre board result update'){
										$pre_board_result_update=$display['status'];
									}
									if($display['role_name']=='mid term result update'){
										$mid_term_result_update=$display['status'];
									}
									if($display['role_name']=='monthly attendance sheet'){
										$monthly_attendance_sheet=$display['status'];
									}
									if($display['role_name']=='inter attendance'){
										$inter_attendance=$display['status'];
									}
									if($display['role_name']=='bs attendance'){
										$bs_attendance=$display['status'];
									}
									if($display['role_name']=='archive'){
										$archive=$display['status'];
									}
									if($display['role_name']=='presentation marks'){
										$presentation_marks=$display['status'];
									}
									if($display['role_name']=='presentation result'){
										$presentation_result=$display['status'];
									}
									if($display['role_name']=='presentation result update'){
										$presentation_result_update=$display['status'];
									}
									if($display['role_name']=='quiz marks'){
										$quiz_marks=$display['status'];
									}
									if($display['role_name']=='quiz result'){
										$quiz_result=$display['status'];
									}
									if($display['role_name']=='quiz result update'){
										$quiz_result_update=$display['status'];
									}
									if($display['role_name']=='banner_message'){
										$banner_message=$display['status'];
									}
								}
}
?> -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
	<title>Program Record Entry</title>
	<link rel="stylesheet" href="../styles/dashboard.css">
<script>
			function setExamValue(exam) {
				document.getElementById('exam').value = exam;
			}
			

</script>
</head>
<body>
	<div class="sticky">
	<div class="login-container">
    	<div class="header">
        <img class="imglogo" src="./img/logo.png" alt="Logo">
				<label for="tab-1" class="tab">GOVT DEGREE COLLEGE MATHRA<br>KHYBER PAKHTUNKHWA</label>
				<div class="logout">
					<form name="form1" action="" method="POST">
						<img class="img3" src="./img/three_line2.png" alt="Logo"
							onclick="toggleMenu()">
					</form>
					<ul id="dropdownMenu" class="dropdown-menu">
						<li>
							<a href="#">
								<input type="submit" class="dropbtn" onclick="archive()" value="Archive" name="archive" />
							</a>
						</li>
						<li>
							<form name="form1" action="fine_apply.php" method="POST">
							<a href="#"></a>
								<?php
									if($_SESSION["fid"]==22||$_SESSION["fid"]==24){
										echo	'<input type="submit" class="dropbtn" value="Student Fine" name="Student_Fine" />';
									}
								?>
							</a>
							</form>
						</li>

						<li>
							<form name="form1" action="fine_collection.php" method="POST">
							<a href="#"></a>
								<?php
									if($_SESSION["fid"]==13){
										echo	'<input type="submit" class="dropbtn" value="Student Fine Collection" name="Student_Fine_collection" />';
									}
								?>
							</a>
							</form>
						</li>
						<li>
							<form name="form1" action="struckoff.php" method="POST">
							<a href="#"></a>
								<?php
									if($_SESSION["fid"]==15){
										echo	'<input type="submit" class="dropbtn" value="StruckOff List" name="StruckOff_List" />';
									}
								?>
							</a>
							</form>
						</li>
						<li>
							<a href="#">
								<form name="form2" action="./pswr.php" method="POST">
									<input name="fid" type="hidden" value="<?php echo $_SESSION['fid']; ?>">
									<input type="submit" class="dropbtn" value="PIN Change" name="pswchange" />
								</form>
							</a>
						</li>
						<li>
							<a href="./downloads.php">
								<span>Download</span>
							</a>
						</li>
						<li>
							<a href="/logout">
								LOGOUT
							</a>
						</li>
					</ul>
				</div>
	</div>
	</div>			

            <div class="fbar">MR. <%=userData.faculty_name %> ( <%=userData.designation %> ) </div>
            		<div class="datebar">Dated: <%= date %></div>
	</div>
	
	<div  class="entry">
	<div class="entry1">

	
	<div id="archive" class="search" style="display='block'">
		<div class="search1">'
			
			<table class="archive-font">
				<thead>    
				<tr class="archive-font">
					<td>S.No</td>
					<td>PSF_ID</td>
					<td>INSTRUCTOR</td>
					<td>PROGRAM</td>
					<td>SECTION</td>
					<td>YEAR</td>
					<td>SUBJECT</td>
					<td>MONTH</td>
					<td>ACTION</td>
				</tr>
			</thead>
			<tbody>
			<% psfData.forEach((row, index) => { %>
				<% if (row.psf_status==0) { %>
				<tr>
				<td><%= index + 1 %></td>
				<td><%= row.psf_id %></td>
				<td><%= row.faculty_name.toUpperCase() %></td>
				<td><%= row.program_name %></td>
				<td><%= row.class_name %> - <%= row.section_name %></td>
				<td><%= row.year %></td>
				<td><%= row.subject_name %></td>
				<td>
					<select class="selectdate" name="month" id="monthDropdown" >
						<% if (row.months) { 
								row.months.split(",").forEach(m => { 
								let year = m.substring(0,4);
								let month = m.substring(5,7);

								const monthNames = [
													"Jan","Feb","Mar","April","May","June",
													"July","Aug","Sept","Oct","Nov","Dec"
								];
								let monthName = monthNames[parseInt(month)-1];
						%>
							<option value="<%= month %>-01">
								<%= monthName %> - <%= year %>
							</option>
						<%   }) 
							} else { %>
							<option value="">No Records</option>
						<% } %>
					</select>
				</td>
				<td>
					<form method="POST" action="/printpdf">
					<input type="hidden" name="psfid" value="<%= row.psf_id %>">
					<input type="hidden" name="pid" value="<%= row.program_id %>">
					<input type="hidden" name="sname" value="<%= row.subject_name %>">
					<input  name="pname" type="hidden" value="<%= row.pf_name %>">
					<input  name="class_name" type="hidden" value="<%= row.class_name %>" >
					<button type="submit">Attendance List</button>
					</form>
				</td>
				</tr>
				
				<% } %>
			<% }) %>
		</tbody>
		</table>
		</div>
	</div>
		
	<% psfData.forEach((row, index) => { %>
		

		<%if(row.psf_status==1 && row.duration==2){%>
			<div class="search"><div class="search1">	
			<button name="a_list" value="Click" class="bt1">
				
				Today\'s Attendance : <%=date%><br><%=row.program_name.toUpperCase()%><br><%= row.class_name%><br><%= row.subject_name%>
				</button>

				<select class="selectdate" name="month" id="monthDropdown" >
						<% if (row.months) { 
								row.months.split(",").forEach(m => { 
								let year = m.substring(0,4);
								let month = m.substring(5,7);

								const monthNames = [
													"Jan","Feb","Mar","April","May","June",
													"July","Aug","Sept","Oct","Nov","Dec"
								];
								let monthName = monthNames[parseInt(month)-1];
						%>
							<option value="<%= month %>-01">
								<%= monthName %> - <%= year %>
							</option>
						<%   }) 
							} else { %>
							<option value="">No Records</option>
						<% } %>
					</select>        
					<button name="all_list" value="" class="bt3" type="submit">Full Attendence List</button>
					<hr>
					<button name="inprevious" value="" class="bt1" type="submit">Mark Previous Attendance</button>
					<button name="markleave" value="" class="bt1" type="submit">Update Attendance (Individual)</button>
					<div class="mid-term">
						<label class="heading">Pre-Board</label><hr>
						<button name="marking" value="pre_board_marking" class="bt1" type="submit" style="margin-right: 10px;" >Marking</button>  
						<button name="result" value="pre_board_result" class="bt1" type="submit" style="margin-right: 10px;">View Result</button>  
						<button name="result_update" value="" class="bt1" type="submit" style="margin-right: 10px;" >Update</button>
					</div>

			</div></div>		
			<%}%>

			<%})%>
				



	</div></div>

	<script>

			

					function setExamValue(value) {
						let elements = document.getElementsByClassName('exam');
						for (let i = 0; i < elements.length; i++) {
							elements[i].value = value;
						}
			}
			function archive(){
				var x= document.getElementById("archive");
				if(x.style.display==="block"){
					x.style.display="none";
				}else{
					x.style.display="block";
				}
			}
			function toggleMenu() {
				var menu = document.getElementById('dropdownMenu');
				if (menu.style.display === 'none' || menu.style.display === '') {
					menu.style.display = 'block';
				} else {
					menu.style.display = 'none';
				}
			}

			// Optional: Close the menu when clicking outside of it
			document.addEventListener('click', function(event) {
				var isClickInside = document.querySelector('.logout').contains(event.target);
				var menu = document.getElementById('dropdownMenu');

				if (!isClickInside) {
					menu.style.display = 'none';
				}
			});
	</script>
</body>
</html>
