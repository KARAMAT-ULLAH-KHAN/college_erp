<!DOCTYPE html>
<!-- <?php
include 'connection.php
include 'address.php
SESSION_START();


if(isset($_SESSION['usersession'])&&$_SESSION['acclvl']==0){

}
else{
session_destroy();
mysqli_close($conn);
header("Location:./index.php");
}
if(isset($_POST['logout'])){
session_destroy();
mysqli_close($conn);
header("Location:./index.php");
}
{
	$check = mysqli_query($conn,"select * from roles");
								while($display= mysqli_fetch_array($check))
								{
									if($display['role_name']=='current attendance'){
										$current_attendance=$display['status'];
									}
									if($display['role_name']=='previous attendance'){
										$previous_attendance=$display['status'];
									}
									if($display['role_name']=='mark leaves'){
										$mark_leaves=$display['status'];
									}
									if($display['role_name']=='pre board marking'){
										$pre_board_marking=$display['status'];
									}
									if($display['role_name']=='pre board result'){
										$pre_board_result=$display['status'];
									}
									if($display['role_name']=='mid term marking'){
										$mid_term_marking=$display['status'];
									}
									if($display['role_name']=='mid term result'){
										$mid_term_result=$display['status'];
									}
									if($display['role_name']=='pre board result update'){
										$pre_board_result_update=$display['status'];
									}
									if($display['role_name']=='mid term result update'){
										$mid_term_result_update=$display['status'];
									}
									if($display['role_name']=='monthly attendance sheet'){
										$monthly_attendance_sheet=$display['status'];
									}
									if($display['role_name']=='inter attendance'){
										$inter_attendance=$display['status'];
									}
									if($display['role_name']=='bs attendance'){
										$bs_attendance=$display['status'];
									}
									if($display['role_name']=='archive'){
										$archive=$display['status'];
									}
									if($display['role_name']=='presentation marks'){
										$presentation_marks=$display['status'];
									}
									if($display['role_name']=='presentation result'){
										$presentation_result=$display['status'];
									}
									if($display['role_name']=='presentation result update'){
										$presentation_result_update=$display['status'];
									}
									if($display['role_name']=='quiz marks'){
										$quiz_marks=$display['status'];
									}
									if($display['role_name']=='quiz result'){
										$quiz_result=$display['status'];
									}
									if($display['role_name']=='quiz result update'){
										$quiz_result_update=$display['status'];
									}
									if($display['role_name']=='banner_message'){
										$banner_message=$display['status'];
									}
								}
}
?> -->
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<title>Program Record Entry</title>
	<link rel="stylesheet" href="../styles/currentAttendance.css" />
	<link rel="stylesheet" href="../styles/header.css" />
	<link rel="stylesheet" href="../styles/footer.css" />

	<script src="../scripts/currentAttendanceUP.js"></script>
	
</head>

<body>
	<%- include('../header.ejs')%>

		<div class="entry">
			<div class="entry1">
				<!-- code for archive record -->

				<div id="archive" class="search" style="display='none'">
					<div class="search1">
						'

						<table class="archive-font">
							<thead>
								<tr class="archive-font">
									<td>S.No</td>
									<td>PSF_ID</td>
									<td>INSTRUCTOR</td>
									<td>PROGRAM</td>
									<td>SECTION</td>
									<td>YEAR</td>
									<td>SUBJECT</td>
									<td>MONTH</td>
									<td>ACTION</td>
								</tr>
							</thead>
							<tbody>
								<% psfData.forEach((row, index)=> { %>
									<% if (row.psf_status==0) { %>
										<tr>
											<td>
												<%= index + 1 %>
											</td>
											<td>
												<%= row.psf_id %>
											</td>
											<td>
												<%= row.faculty_name.toUpperCase() %>
											</td>
											<td>
												<%= row.program_name %>
											</td>
											<td>
												<%= row.class_name %> - <%= row.section_name %>
											</td>
											<td>
												<%= row.year %>
											</td>
											<td>
												<%= row.subject_name %>
											</td>
											<td>
												<select class="selectdate" name="month" id="monthDropdown">
													<% if (row.months) { row.months.split(",").forEach(m=> {
														let year = m.substring(0,4); let month = m.substring(5,7);
														const monthNames = [
														"Jan","Feb","Mar","April","May","June",
														"July","Aug","Sept","Oct","Nov","Dec" ]; let monthName =
														monthNames[parseInt(month)-1]; %>
														<option value="<%= month %>-01">
															<%= monthName %> - <%= year %>
														</option>
														<% }) } else { %>
															<option value="">No Records</option>
															<% } %>
												</select>
											</td>
											<td>
												<form method="POST" action="/printpdf">
													<input type="hidden" name="psfid" value="<%= row.psf_id %>" />
													<input type="hidden" name="pid" value="<%= row.program_id %>" />
													<input type="hidden" name="sname" value="<%= row.subject_name %>" />
													<input name="pname" type="hidden" value="<%= row.pf_name %>" />
													<input name="class_name" type="hidden"
														value="<%= row.class_name %>" />
													<button class="bt1 custom" type="submit">
														Attendance List
													</button>
												</form>
											</td>
										</tr>

										<% } %>
											<% }) %>
							</tbody>
						</table>
					</div>
				</div>

				<!--	code for current date attendance list	-->

				<div class="fbar">
					<%=classData[0].program_name %> - <%=classData[0].class_name%> - <%= classData[0].section_name%>
				</div>

				<div class="search">
					<div class="search1">
						<form action="/attendance/saveAttendance" method="post">
						<table>
							<input type="submit" value="save" id="savebutton" name="save"><br>
							<tr>
								<td>Class.No</td>
								<td>Roll_No</td>
								<td>Student Name</td>
								<td>Status</td>
								<td>remarks</td>
							</tr>
							
							<% classData.forEach((row, index)=> { %>
								<tr>
									<td>
										<%=row.class_no%>
									</td>
									<td>
										<%=row.inter_bs%> - <%=row.class_no%> - <%=row.year%>
									</td>
									<td>
										<%=row.student_name%>
									</td>
									<td>
										<button 
											type="button" 
											data-enrollment="<%= row.enrollment_id %>"   
											onclick="toggleAttendance(this)"  
											value="A">A
										</button>
										<input type="hidden" name="attendance[<%= row.enrollment_id %>]" value="A">
										
										</td>
									<td></td>
									
								</tr>
								<%})%>
							</table>
							<input type="hidden" name="psfid" value="<%=psfData[0].psf_id%>">
							</form>	
					</div>
				</div>

			</div>
		</div>

		<%- include('../footer.ejs')%>
			<script src="../scripts/dashboardScript.js">
			</script>

</body>

</html>